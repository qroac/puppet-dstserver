<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  File: README
  
    &mdash; Documentation by YARD 0.9.24
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="puppet_class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="puppet_class_list_link"
        href="puppet_class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><div id='filecontents'>
<h1 id="label-dstserver">dstserver</h1>

<p>A module to manage a set of server instances for Don&#39;t Starve Together
on your machines.</p>

<p><strong>Important Note</strong><br> This module was built and tested for my
debian and ubuntu machines, but I don&#39;t see a reason, why it
shouldn&#39;t work on redhat/centos as well.<br> It hasn&#39;t been tested
there yet, so if you run it on a RPM based machine, for your constructive
feedback I&#39;d be very appreciated.</p>

<h4 id="label-Table+of+Contents">Table of Contents</h4>
<ol><li>
<p><a href="#label-Description">Description</a></p>
</li><li>
<p><a href="#label-Setup">Setup - The basics of getting started with dstserver</a></p>
<ul><li>
<p><a href="#label-Setup+requirements">Setup requirements</a></p>
</li><li>
<p><a href="#label-Beginning+with+dstserver">Beginning with dstserver</a></p>
</li></ul>
</li><li>
<p><a href="#label-Usage">Usage - Configuration options and additional
functionality</a></p>
<ul><li>
<p><a href="#label-Node+configuration+parameters">Node Configuration Parameters</a></p>
</li><li>
<p><a href="#label-Instance+configuration+parameters">Instance Configuration
Parameters</a></p>
</li><li>
<p><a href="#label-Mod+config">Mod Config</a></p>
</li><li>
<p><a href="#label-Worldgenoverride+config">Worldgenoverride Config</a></p>
</li></ul>
</li><li>
<p><a href="#label-Limitations">Limitations - OS compatibility, etc.</a></p>
</li><li>
<p><a href="#label-Development">Development - Guide for contributing to the
module</a></p>
</li></ol>

<h2 id="label-Description">Description</h2>

<p>This module manages Dont Starve Together servers on your server, generating
worldgen-configs, modoverride settings and mod install lists based on each
nodes configuration.<br> However, it is for now limited to a
<em>classic</em> setup consisting of one Overworld (master) and (optional)
one Cave shard per instance.<br> For each shard it further installs a
SystemD service script to start and stop the server process.<br> There is
also an update script that can be run as root to update the DST
installation on your server.</p>

<h2 id="label-Setup">Setup</h2>

<h3 id="label-Setup+Requirements">Setup Requirements</h3>

<p>For each instance, you need to obtain a server token during your Klei
account at <a
href="https://accounts.klei.com/account/game/servers?game=DontStarveTogether.<br>“>accounts.klei.com/account/game/servers?game=DontStarveTogether.<br></a>
You will need to provide the token in the later configuration.<br> You
don&#39;t need to get creative at this point, all settings including the
servername will be set by the actual server configuration on your server.</p>

<p>Further this module depends on tamerz-steamcmd for installation of
SteamCMD.</p>

<h3 id="label-Beginning+with+dstserver">Beginning with dstserver</h3>

<p>For a quickstart with dstserver, be sure to obtain a token for your server
as noted in Setup Requirements.<br> In your node definition, include the
dstserver class passing in your server token for the default server:<br>
<code>class {&#39;dstserver&#39;: token =&gt;
&#39;Your-Token-Goes-Here&#39; }</code></p>

<p><strong>Important Note:</strong> This is only for quickstart and demo
purpose. Passing the token like this will globally override the token for
all DST server instances on this node. See usage below to propper configure
your DST server.</p>

<p>The example above will perform the following steps on your node:</p>
<ul><li>
<p>Install SteamCMD</p>
</li><li>
<p>Create a system user <code>server-dst</code> and home directory
<code>/srv/dst</code></p>
</li><li>
<p>Install DST dedicated server at <code>/srv/dst/app</code></p>
</li><li>
<p>Place the install and update script in <code>/srv/dst/bin</code></p>
</li><li>
<p>Configure a default server instance in
<code>/srv/dst/.klei/DoNotStarveTogether/default</code></p>
</li><li>
<p>Place SystemD scripts for master and caves, ensuring they are enabled and
running</p>
</li></ul>

<h2 id="label-Usage">Usage</h2>

<p>As shown above, you can include dstserver in your node definition using the
class syntax. This enables you to directly pass your custom configuration
to the module:</p>

<pre class="code ruby"><code class="ruby">class { &#39;dstserver&#39;: 
  ensure    =&gt; present,
  user      =&gt; &#39;server-dst&#39;,
  homedir   =&gt; &#39;/srv/dst&#39;,
  instances =&gt; [
    ... Array containing hashes of instance configuration, see Configuration section below
  ],
}
</code></pre>

<p>However, you can leave the class attributes to the default values provided
or set them using hiera (see data/common.yaml as example).<br> If your
instances are configured this way, you can just include dstserver to your
node:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_include'>include</span> <span class='id identifier rubyid_dstserver'>dstserver</span>
</code></pre>

<h3 id="label-Node+Configuration+Parameters">Node Configuration Parameters</h3>

<p>To set the parameters with hiera, just prefix them with
<code>dstserver::</code>, e.g. <code>dstserver::instances:</code></p>

<p>| Option | Default | Description | | ————| ———————-| ————| | ensure |
present | <strong>present</strong> install dstserver on node <br>
<strong>absent</strong> remove dstserver from node, ensure to set all
instances to absent in a previous run, to ensure all systemd services are
removed | | user | server-dst | Username for the system user running DST |
| homedir | /srv/dst | Home directory for the system user holding DST
installation and server profiles | | instances | see data/common.yaml |
Hash with configuration for multiple DST server instances, see below |</p>

<h3 id="label-Instance+Configuration+Parameters">Instance Configuration Parameters</h3>

<p>Pass a hash of hashes containing the following fields to the dstserver
class statement or set the configuration in your hiera data as shown in
data/common.yaml</p>

<p>One hash in the config hash per instance, key is the system name (used for
foldername and servicename), values hold the specific configuration.</p>

<pre class="code ruby"><code class="ruby">dstserver::instances:
  default:
    servername: My DST Server
      description: Are you able to survive the first winter?
      mode: survival
      intention: cooperative
      token: your-server-token-from-klei-goes-here
      players: 5
  the-easy:
    servername: My easy Server
      description: Again and again ...
      mode: endless
      intention: social
      token: your-server-token-from-klei-goes-here
      players: 10
</code></pre>

<p>Instance configuration options in alphabetical order, required parameters
are <strong>bold</strong>: | Option | Default | Description | | ——————|
————–| ————| | autosave | <code>true</code> | Automatically save the world
after midnight | | caves | <code>false</code> | Create and run an instance
of the caves for this server instance | | clusterkey |
<code>&#39;dst&#39;</code> | Cluster internal key for authenticating the
shards inside the cluster | | console | <code>true</code> | Enable or
disable the server console | | description | <code>&#39;&#39;</code> |
Description of your server for the public server list | | ensure |
<code>&#39;present&#39;</code> | <strong>present</strong>: create and
configure and run the server instance <br> <strong>absent</strong>: remove
the server instance from the node | | intention |
<code>&#39;social&#39;</code> | Play style intention on your server. Choose
from: <em>social</em>, <em>cooperative</em>, <em>competetive</em>,
<em>madness</em> | | mode | <code>&#39;survival&#39;</code> | Server mode
of this instance. Choose from <em>survival</em>, <em>wilderness</em>,
<em>endless</em> | | mods | <code>undef</code> | Configuration of Mods for
this instance, see section <strong>Mod Config</strong> below| | pause |
<code>true</code> | Enable or disable automatic pause when there are no
players on the server | | password | <code>&#39;&#39;</code> | Password to
join the server | | players | <code>5</code> | Amount of players that could
join simultanously | | pvp | <code>false</code> | Enable or disable PVP | |
servername | <code>$name</code> | Name of the server in the serverlist.
Defaults to the key in the instance list (e.g. default, the-easy) | |
startport | <code>11031</code> | First port to use for cluster and shards.
Will consume 7 ports in total. E.g. from 11031 to 11037 | |
<strong>token</strong> | | Your klei server token for this server instance,
see <strong>Setup Requirements</strong> | | vote_kick | <code>true</code> |
Enable or disable voting to kick players | | worldgenoverrides |
<code>undef</code> | Overrides for world generation, see section
<strong>Worldgenoverride Config</strong> below |</p>

<h3 id="label-Mod+Config">Mod Config</h3>

<p>For each instance you can provide a list of mods.<br> This will generate a
serverwide list of required mod ids to be installed upon restart of an
instance. This way it is ensured, that mods get updated everytime an
instance is restarted.</p>

<p>To include a mod, list its ID in the mods hash with the desired activation
state as value. <code>true</code> downloads the mod and activates it on
this instance, <code>false</code> downloads the mod but leaves it as
disabled in the instances modoverride.lua config.</p>

<p>To provide further custom configuration for a mod, you can use a subhash
containing the fields <code>enabled</code> (true or false, as before) and
config (containing a text block with the configuration to write into
modoverride.lua).</p>

<p>This example shows both ways. Just including and activatting mods and
including one with additional configuration.</p>

<pre class="code ruby"><code class="ruby">mods:
  # Minimap HUD
  345692228: false
  # Combined Status
  376333686: true
  # Ultimate Starting Item Tuner
  1627929571:
    enabled: true
    # Additional configuration for the mod
    config: |
      ShouldOverrideMod=false,
      ShouldOverrideVanila=false,
      Data = {
          [&quot;AllPlayers&quot;] = {
              [&quot;respawnnight&quot;] = {
                  &quot;torch&quot;
              },
              [&quot;&quot;] = {
                  &quot;backpack&quot;
              }
          }
        }
</code></pre>

<h3 id="label-Worldgenoverride+Config">Worldgenoverride Config</h3>

<p>You can set Worldgenoverride settings for Overworld and Cave Shards
providing a configuration hash if intended.</p>

<pre class="code ruby"><code class="ruby">worldgenoverrides:
  master:
    enabled: true
    preset: SURVIVAL_TOGETHER
    overrides:
      world_size: huge
  caves:
    enabled: true
    preset: DST_CAVE_PLUS
</code></pre>

<p>Use <code>enabled</code> to turn the overrides on or off and
<code>preset</code> to choose an official worldgen preset for your new
instance.<br> <code>overrides</code> is just a hash with key-value pairs to
list in the overrides-object of the worldgenoverride file.</p>

<p>For available presets and a list of possible overrides, please refer to the
<a
href="https://dontstarve.fandom.com/wiki/Guides/Simple_Dedicated_Server_Setup#World_Customization">documentation
in the dst wiki</a></p>

<h2 id="label-Limitations">Limitations</h2>

<p>You cannot deploy <em>fancy setups</em>, e.g. with multiple Overworld-Cave
Shards in the same setup. For most server setups it should be sufficient,
though.</p>

<p>Further, this module was created on and for debian/ubuntu machines. I
don&#39;t see a reason why it shouldn&#39;t work on Redhad, but lack of a
redhat server and time to set it up I didn&#39;t verify that yet. So if you
use this on redhat/centos and it works (or not), please let me know ;)</p>

<h2 id="label-Development">Development</h2>

<p>This module was created based on the needs for my own private dst server
setup.<br> It is my first puppet module and I code on it in my spare time.</p>

<p>Please use the issue tracker to report bugs with concrete examples how to
reproduce the problem.<br> You could also submit feature requests, but
because I do this in my spare time I can not guarantee to implement them.</p>

<p>Furthermore I appreciate Pull Requests for bugfixes and new features
including:</p>
<ul><li>
<p>a detailled description on the change</p>
</li><li>
<p>for bugfixes: what problem is solved (scenario / issue #)</p>
</li><li>
<p>for features: why / what for the new feature is needed</p>
</li><li>
<p>corrections and additions in the documentation as needed</p>
</li></ul>
</div></div>

      <div id="footer">
     Generated by <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>.
</div>

    </div>
  </body>
</html>